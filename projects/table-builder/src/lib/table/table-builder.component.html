<div
    #root
    observerView
    [style.width]="width"
    class="table-grid__root"
    [style.height.px]="height"
    *ngIf="contentInit && source?.length"
    (contextmenu)="contextMenu.openContextMenu($event)"
    [class.table-grid__root-auto-height]="autoHeightDetect"
    [class.table-grid__root--visible]="contentInit && root.offsetHeight > clientRowHeight && columnHeight"
    (observeVisible)="inViewport = $event"
    (recalculatedHeight)="detectChanges()"
    [@fadeAnimation]="'in'"
    [autoHeight]="{
        detect: autoHeightDetect,
        height: height,
        inViewport: inViewport,
        columnHeight: columnHeight,
        statusRendered: isRendered
    }"
>
    <div
        #tableViewport
        wheelThrottling
        class="table-grid"
        (scrollEnd)="scrollEnd()"
        (scrollOverload)="updateScrollOverload($event)"
        (scrollOffset)="updateScrollOffset($event)"
        [class.table-grid__native-scrollbar]="nativeScrollbar"
    >
        <div
            #column
            observerView
            [attr.column-id]="key"
            [rendered]="isRendered"
            class="table-grid__column"
            [style.height.px]="columnHeight"
            [ngStyle]="columnsSchema[key]?.cssStyle"
            [ngClass]="columnsSchema[key]?.cssClass"
            [style.width.px]="columnsSchema[key]?.width"
            *ngFor="let key of displayedColumns; let index = index"
            [style.min-width.px]="columnsSchema[key]?.width || clientColWidth"
            [class.table-grid__column--vertical-line]="verticalBorder || columnsSchema[key]?.verticalLine"
            [class.table-grid__column--custom-column]="columnsSchema[key]?.customColumn"
            [class.table-grid__column--selected-all]="selection.selectionModel.isAll"
            [class.table-grid__column--sticky-left]="columnsSchema[key]?.stickyLeft"
            [class.table-grid__column--sticky-right]="columnsSchema[key]?.stickyRight"
            [class.table-grid__column--is-visible]="column['visible']"
            [class.table-grid__column--is-invisible]="!column['visible']"
            [class.table-grid__column--default-width]="!autoWidth"
            (observeVisible)="markVisibleColumn(column, $event)"
        >
            <div
                class="table-grid__column-area"
                *ngIf="asyncColumns === false || column['visible']"
                [@fadeAnimation]="'in'"
            >
                <table-thead
                    [column-key]="key"
                    [definition]="sortable.definition"
                    [client-row-height]="clientRowHeight"
                    [class.table-head__offset]="scrollOffset.offset"
                    (resize)="resizeColumn($event, column)"
                    (sortByKey)="sortByKey($event)"
                ></table-thead>

                <table-tbody
                    [source]="source"
                    [column-key]="key"
                    [striped]="striped"
                    [column-index]="index"
                    [primary-key]="primaryKey"
                    [throttling]="throttling"
                    [buffer-amount]="bufferAmount"
                    [table-viewport]="tableViewport"
                    [scroll-overload]="scrollOverload"
                    [enable-selection]="enableSelection"
                    [client-row-height]="clientRowHeight"
                    [selection-entries]="selectionEntries"
                    [showed-cell-by-default]="showedCellByDefault"
                    [column-virtual-height]="columnVirtualHeight"
                >
                </table-tbody>
            </div>
        </div>
    </div>

    <div *ngIf="freezeTable" class="freeze"></div>
</div>

<ng-template [ngIf]="contextMenuTemplate">
    <ng-content select="ngx-context-menu"></ng-content>
</ng-template>
