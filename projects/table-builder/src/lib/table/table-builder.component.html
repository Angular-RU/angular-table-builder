<div
    #root
    observerView
    [style.width]="width"
    class="table-grid__root"
    [style.height.px]="height"
    [class.table-grid__root--is-rendered]="isRendered"
    [class.table-grid__root--is-scrolling]="isScrolling"
    [class.table-grid__root-auto-height]="autoHeightDetect"
    [class.table-grid__no-display]="!(columnSchema.length > 0)"
    [class.table-grid__root--content-is-init]="contentInit && inViewport"
    [class.table-grid__root--is-scroll-overload]="tableViewport.scrollWidth > tableViewport.clientWidth"
    [class.table-grid__root--empty-list]="!source?.length && !filterable.filtering && !isFrozenView"
    [class.table-grid__root--visible]="contentInit && root.offsetHeight > clientRowHeight && columnHeight"
    (contextmenu)="contextMenuTemplate ? contextMenu.openContextMenu($event) : null"
    (recalculatedHeight)="recalculateHeight()"
    (observeVisible)="checkVisible($event)"
    [autoHeight]="{
        detect: autoHeightDetect,
        height: height,
        inViewport: inViewport,
        columnHeight: columnHeight,
        statusRendered: isRendered,
        sourceLength: source?.length || 0
    }"
    [tableViewport]="tableViewport"
    [headerHeight]="headerRef?.nativeElement.clientHeight"
    [footerHeight]="footerRef?.nativeElement.clientHeight"
>
    <div
        cdkDropList
        #tableViewport
        class="table-grid"
        [wheelThrottling]="tableViewport"
        [cdkDropListDisabled]="!accessDragging"
        (scrollOffset)="updateScrollOffset($event)"
        [class.table-grid__scroll-offset]="scrollOffset.offset"
        [class.table-grid__native-scrollbar]="nativeScrollbar"
        cdkDropListOrientation="horizontal"
        (cdkDropListDropped)="drop($event)"
    >
        <div
            [@fadeAnimation]
            *ngIf="isRendered"
            [style.height.px]="root.offsetHeight"
            class="table-grid__column-area-content"
            [style.width.px]="
                tableViewportChecked && tableViewport.scrollWidth > tableViewport.clientWidth
                    ? tableViewport.scrollWidth
                    : null
            "
        >
            <ngx-loading></ngx-loading>
            <div class="virtual-scroll-viewport">
                <cdk-virtual-scroll-viewport
                    autosize
                    [itemSize]="clientRowHeight"
                    [style.height.px]="root.offsetHeight"
                    [minBufferPx]="autosize ? root.offsetHeight * 2 : 500"
                    [maxBufferPx]="autosize ? root.offsetHeight * 2 : 500"
                >
                    <ngx-table-body
                        [item]="source[0]"
                        [even]="false"
                        [index]="0"
                        [columnSchema]="columnSchema"
                        [style.top]="inverseTranslation"
                        class="table-grid__row table-grid__row--head"
                        [style.min-height.px]="autosize ? null : clientRowHeight"
                        [style.max-height.px]="autosize ? null : clientRowHeight"
                    >
                    </ngx-table-body>

                    <ng-container *cdkVirtualFor="let item of source; let index = index; let even = even">
                        <ngx-table-body
                            [item]="item"
                            [even]="even"
                            [index]="index"
                            [striped]="striped"
                            class="table-grid__row"
                            [columnSchema]="columnSchema"
                            [style.min-height.px]="autosize ? null : clientRowHeight"
                            [style.max-height.px]="autosize ? null : clientRowHeight"
                        ></ngx-table-body>
                    </ng-container>
                </cdk-virtual-scroll-viewport>
            </div>
        </div>
    </div>
</div>
